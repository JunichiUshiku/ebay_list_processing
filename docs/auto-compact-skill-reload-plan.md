# Auto-compactå¾Œã®ã‚¹ã‚­ãƒ«å†èª­ã¿è¾¼ã¿ãƒ»å‡¦ç†å†é–‹è¨ˆç”»

## èƒŒæ™¯ãƒ»å•é¡Œ

- **ç¾è±¡**: Auto-compactç™ºç”Ÿå¾Œã€ã‚¹ã‚­ãƒ«ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒæãªã‚ã‚Œã‚‹
  - ä¾‹: UIãƒ—ãƒ«ãƒ€ã‚¦ãƒ³æ“ä½œ â†’ URLå¤‰æ›´ã«ã‚ˆã‚‹æœŸé–“åˆ‡æ›¿ã«åŠ£åŒ–
  - æ­£ç¢ºã•ã‚ˆã‚ŠåŠ¹çŽ‡åŒ–ã‚’å„ªå…ˆã™ã‚‹ã‚ˆã†ã«ãªã‚‹
- **åŽŸå› **: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåœ§ç¸®æ™‚ã«ã‚¹ã‚­ãƒ«ã®è©³ç´°æ‰‹é †ãŒè¦ç´„ã•ã‚Œã¦ã—ã¾ã†
- **è¦ä»¶**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä»‹å…¥ãªã—ã§å‡¦ç†ã‚’æœ€å¾Œã¾ã§å®Œé‚ã—ãŸã„

## èª¿æŸ»çµæžœ

### Hooksï¼ˆæŽ¡ç”¨ï¼‰
| ãƒ•ãƒƒã‚¯ | ãƒžãƒƒãƒãƒ£ãƒ¼ | ç”¨é€” | æ¤œè¨¼çµæžœ |
|--------|-----------|------|----------|
| `SessionStart` | `compact` | åœ§ç¸®å¾Œã«ã‚¹ã‚­ãƒ«å†æ³¨å…¥ | âœ… æ­£ã—ãå‹•ä½œ |

### Auto-compactå‹•ä½œ
- ãƒˆãƒªã‚¬ãƒ¼: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ95%è¶…éŽæ™‚
- SKILL.md/CLAUDE.md: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãŸã‚**ä¿æŒã•ã‚Œã‚‹**
- ä¼šè©±å±¥æ­´: è¦ç´„ãƒ»åœ§ç¸®ã•ã‚Œã‚‹ï¼ˆè©³ç´°ãŒå¤±ã‚ã‚Œã‚‹ï¼‰
- SessionStartã®stdout: **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è‡ªå‹•è¿½åŠ ã•ã‚Œã‚‹**

## è§£æ±ºç­–: ã‚¹ã‚­ãƒ«é–‹å§‹æ™‚è¨˜éŒ² + SessionStartãƒ•ãƒƒã‚¯æ–¹å¼

### ä»•çµ„ã¿

```
[ã‚¹ã‚­ãƒ«é–‹å§‹] â†’ skill-state.json ã«ç¾åœ¨ã®ã‚¹ã‚­ãƒ«åã‚’è¨˜éŒ²
     â†“
[å‡¦ç†ä¸­] â†’ [Auto-compactç™ºç”Ÿ] â†’ [åœ§ç¸®å®Ÿè¡Œ]
                                       â†“
[å‡¦ç†å†é–‹] â† [è©²å½“ã‚¹ã‚­ãƒ«å†å®Ÿè¡ŒæŒ‡ç¤º] â† [SessionStart(compact)]
```

### ãƒã‚¤ãƒ³ãƒˆ
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ã‚«ãƒ«è¨­å®š**: ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ã¿ãƒ•ãƒƒã‚¯ãŒå‹•ä½œ
- **å‹•çš„ã‚¹ã‚­ãƒ«æ¤œå‡º**: å®Ÿè¡Œä¸­ã ã£ãŸã‚¹ã‚­ãƒ«ã®ã¿ãŒå†é–‹å¯¾è±¡

## å®Ÿè£…å†…å®¹

### 1. ã‚¹ã‚­ãƒ«å†æ³¨å…¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆSessionStartæ™‚ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/Users/jushiku/ebayåœ¨åº«ä»•å…¥ã‚Œå‡¦ç†/.claude/hooks/reload-skill.sh`

```bash
#!/bin/bash
STATE_FILE="$HOME/.claude/skill-state.json"

if [ -f "$STATE_FILE" ]; then
  cat "$STATE_FILE"
  rm "$STATE_FILE"  # 1å›žä½¿ç”¨ã—ãŸã‚‰å‰Šé™¤
fi
```

### 2. ãƒ•ãƒƒã‚¯è¨­å®šï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/Users/jushiku/ebayåœ¨åº«ä»•å…¥ã‚Œå‡¦ç†/.claude/settings.json`

```json
{
  "hooks": {
    "SessionStart": [
      {
        "matcher": "compact",
        "hooks": [
          {
            "type": "command",
            "command": "/Users/jushiku/ebayåœ¨åº«ä»•å…¥ã‚Œå‡¦ç†/.claude/hooks/reload-skill.sh",
            "timeout": 5
          }
        ]
      }
    ]
  }
}
```

### 3. å„SKILL.md ã¸ã®è¿½è¨˜ï¼ˆStep 0ï¼‰

**ebay-sold-count/SKILL.md:**
```markdown
### Step 0: å®Ÿè¡Œä¸­ã‚¹ã‚­ãƒ«ã‚’è¨˜éŒ²ï¼ˆå¿…é ˆãƒ»æœ€åˆã«å®Ÿè¡Œï¼‰

ä»¥ä¸‹ã®Bashã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚¹ã‚­ãƒ«çŠ¶æ…‹ã‚’è¨˜éŒ²:

\`\`\`bash
cat > ~/.claude/skill-state.json << 'EOF'
{
  "skill": "ebay-sold-count",
  "message": "ã‚¹ã‚­ãƒ« ebay-sold-count ã‚’å†å®Ÿè¡Œã—ã€ç¶šãã®å‡¦ç†ã‚’å†é–‹ã—ã¦ãã ã•ã„ã€‚UIãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã§æœŸé–“ã‚’é¸æŠžã—ã€Researchãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ¤œç´¢ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã€‚URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã®æœŸé–“å¤‰æ›´ã¯ç¦æ­¢ã€‚"
}
EOF
\`\`\`
```

**ebay-sourcing/SKILL.md:**
```markdown
### Step 0: å®Ÿè¡Œä¸­ã‚¹ã‚­ãƒ«ã‚’è¨˜éŒ²ï¼ˆå¿…é ˆãƒ»æœ€åˆã«å®Ÿè¡Œï¼‰

ä»¥ä¸‹ã®Bashã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚¹ã‚­ãƒ«çŠ¶æ…‹ã‚’è¨˜éŒ²:

\`\`\`bash
cat > ~/.claude/skill-state.json << 'EOF'
{
  "skill": "ebay-sourcing",
  "message": "ã‚¹ã‚­ãƒ« ebay-sourcing ã‚’å†å®Ÿè¡Œã—ã€æœªå‡¦ç†ã®è¡Œã‹ã‚‰ä»•å…¥ã‚Œå…ˆæ¤œç´¢ã‚’å†é–‹ã—ã¦ãã ã•ã„ã€‚"
}
EOF
\`\`\`
```

### 4. SKILL.md ã¸ã®é‡è¦ãƒ«ãƒ¼ãƒ«è¿½è¨˜

ã‚¹ã‚­ãƒ«å†’é ­ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼ˆè‹±èªžã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§åœ§ç¸®å¾Œã‚‚ä¿æŒã•ã‚Œã‚„ã™ãï¼‰:

```markdown
## ðŸš¨ CRITICAL RULES (MUST PRESERVE AFTER COMPACTION)

**FORBIDDEN**: dayRange URL parameter changes
**REQUIRED**: UI pulldown â†’ Research button click

**çµ¶å¯¾ç¦æ­¢**: URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆdayRangeï¼‰ã§ã®æœŸé–“å¤‰æ›´
**å¿…é ˆæ‰‹é †**: æœŸé–“å¤‰æ›´ã¯å¿…ãšUIãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ â†’ Researchãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
```

## ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»

| é …ç›® | ãƒˆãƒ¼ã‚¯ãƒ³æ•° |
|------|-----------|
| Step 0 Bashå®Ÿè¡Œ | ~50 |
| å†æ³¨å…¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ~100-200 |
| **åˆè¨ˆè¿½åŠ æ¶ˆè²»** | **æœ€å°é™** |

## ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | æ“ä½œ |
|----------|------|
| `.claude/hooks/reload-skill.sh` | æ–°è¦ä½œæˆ âœ… |
| `.claude/settings.json` | ãƒ•ãƒƒã‚¯è¨­å®šè¿½åŠ ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ âœ… |
| `.claude/skills/ebay-sold-count/SKILL.md` | Step 0 + é‡è¦ãƒ«ãƒ¼ãƒ« + TodoWriteçµ±åˆ âœ… |
| `.claude/skills/ebay-sold-count/references/selectors.md` | æ–°è¦ä½œæˆï¼ˆã‚³ãƒ¼ãƒ‰é‡è¤‡å‰Šæ¸›ï¼‰ âœ… |
| `.claude/skills/ebay-sourcing/SKILL.md` | Step 0 + é‡è¦ãƒ«ãƒ¼ãƒ« + TodoWriteçµ±åˆ âœ… |
| `.claude/skills/ebay-sourcing/references/sites.md` | æ–°è¦ä½œæˆï¼ˆ11ã‚µã‚¤ãƒˆURLåˆ†é›¢ï¼‰ âœ… |

## å®Ÿè£…æ‰‹é †

1. `.claude/hooks/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ï¼‰
2. `reload-skill.sh` ä½œæˆãƒ»å®Ÿè¡Œæ¨©é™ä»˜ä¸Žï¼ˆchmod +xï¼‰
3. `.claude/settings.json` ã«ãƒ•ãƒƒã‚¯è¨­å®šè¿½åŠ 
4. å„SKILL.md ã«Step 0ï¼ˆã‚¹ã‚­ãƒ«çŠ¶æ…‹è¨˜éŒ²ï¼‰è¿½åŠ 
5. ebay-sold-count SKILL.md ã«é‡è¦ãƒ«ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 
6. ãƒ†ã‚¹ãƒˆ: `/compact` ã§æ‰‹å‹•åœ§ç¸®ã—ã¦å‹•ä½œç¢ºèª

## è©•ä¾¡æ¸ˆã¿äº‹é …

| é …ç›® | çŠ¶æ…‹ | å‚™è€ƒ |
|------|------|------|
| SessionStart with matcher "compact" | âœ… | æ­£ã—ãå‹•ä½œ |
| stdoutãŒã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«æ³¨å…¥ | âœ… | SessionStartã§æœ‰åŠ¹ |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ã‚«ãƒ«è¨­å®š | âœ… | ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å½±éŸ¿ã—ãªã„ |
| å‹•çš„ã‚¹ã‚­ãƒ«æ¤œå‡º | âœ… | å®Ÿè¡Œä¸­ã‚¹ã‚­ãƒ«ã®ã¿å†é–‹ |
| çµ¶å¯¾ãƒ‘ã‚¹ä½¿ç”¨ | âœ… | å¯¾å¿œæ¸ˆã¿ |
| SKILL.md/CLAUDE.mdä¿æŒ | âœ… | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãŸã‚åœ§ç¸®ã•ã‚Œãªã„ |

## æ³¨æ„äº‹é …

1. **ClaudeãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¾“ã†ä¿è¨¼ã¯ãªã„**: stdoutã¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹ãŒã€å¿…ãšå®Ÿè¡Œã•ã‚Œã‚‹ä¿è¨¼ã¯ãªã„ã€‚SKILL.mdã®é‡è¦ãƒ«ãƒ¼ãƒ«ã¨çµ„ã¿åˆã‚ã›ã¦åŠ¹æžœã‚’é«˜ã‚ã‚‹
2. **Step 0ã®å®Ÿè¡ŒãŒå¿…é ˆ**: å„ã‚¹ã‚­ãƒ«é–‹å§‹æ™‚ã«Step 0ã‚’å®Ÿè¡Œã—ãªã„ã¨ã€compactå¾Œã®å†é–‹ãŒã§ããªã„

## ä»£æ›¿æ¡ˆï¼ˆä¸æŽ¡ç”¨ï¼‰

| æ¡ˆ | ç†ç”± |
|----|------|
| ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š | ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å½±éŸ¿ã™ã‚‹ |
| ã‚¹ã‚­ãƒ«åãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ | åˆ¥ã‚¹ã‚­ãƒ«å®Ÿè¡Œä¸­ã§ã‚‚å›ºå®šã‚¹ã‚­ãƒ«ãŒå†é–‹ã•ã‚Œã‚‹ |
| Claude-mem | å…¬å¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦å­˜åœ¨ã—ãªã„ |
| ä»¶æ•°åˆ¶é™ã§åœ§ç¸®å›žé¿ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä»‹å…¥ãŒå¿…è¦ã«ãªã‚‹ |
