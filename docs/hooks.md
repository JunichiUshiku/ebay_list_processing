Claude Codeã®hooksæ©Ÿèƒ½ã«ã¤ã„ã¦ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦è©•ä¾¡æ¤œè¨¼ã—ã¾ã™ã€‚ã•ã‚‰ã«è©³ç´°ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€SessionStartã®sourceãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨matcherã®ä»•æ§˜ã‚’èª¿ã¹ã¾ã™ã€‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¾ã—ãŸã€‚è©•ä¾¡æ¤œè¨¼ã®çµæžœã‚’ã¾ã¨ã‚ã¾ã™ã€‚

---

## è©•ä¾¡çµæžœï¼š**ãŠãŠã‚€ã­è§£æ±ºå¯èƒ½**ï¼ˆã„ãã¤ã‹ã®ä¿®æ­£ç‚¹ã‚ã‚Šï¼‰

### âœ… æ­£ã—ã„ç‚¹

**1. PreCompact ãƒ•ãƒƒã‚¯**
PreCompactãƒ•ãƒƒã‚¯ã¯å­˜åœ¨ã—ã€matcherã«ã€Œautoã€ã¾ãŸã¯ã€Œmanualã€ã‚’ä½¿ç”¨ã—ã¦è‡ªå‹•åœ§ç¸®ã¨æ‰‹å‹•åœ§ç¸®ã‚’åŒºåˆ¥ã§ãã¾ã™ã€‚

**2. SessionStart ãƒ•ãƒƒã‚¯**
SessionStartãƒ•ãƒƒã‚¯ã®matcherã¯ä»¥ä¸‹ã«å¯¾å¿œã—ã¦ã„ã¾ã™ï¼š
- `startup` - èµ·å‹•æ™‚
- `resume` - --resume, --continue, /resume ã‹ã‚‰å‘¼ã³å‡ºã—
- `clear` - /clear ã‹ã‚‰å‘¼ã³å‡ºã—
- `compact` - auto ã¾ãŸã¯ manual compact ã‹ã‚‰å‘¼ã³å‡ºã—

ã¤ã¾ã‚Šã€**`matcher: "compact"` ã¯æ­£ã—ãæ©Ÿèƒ½ã—ã¾ã™**ã€‚

**3. SessionStartã®stdoutå‡ºåŠ›**
SessionStartãƒ•ãƒƒã‚¯ã®stdoutå‡ºåŠ›ã¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è‡ªå‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚

---

### âš ï¸ ä¿®æ­£ãŒå¿…è¦ãªç‚¹

**1. settings.json ã®æ§‹é€ **

ææ¡ˆã•ã‚Œã¦ã„ã‚‹è¨­å®š:
```json
{
  "hooks": {
    "PreCompact": [
      {
        "matcher": "auto",
        "hooks": [...]
      }
    ],
    "SessionStart": [
      {
        "matcher": "compact",
        "hooks": [...]
      }
    ]
  }
}
```

ã“ã‚Œã¯æ­£ã—ã„æ§‹é€ ã§ã™ã€‚ãŸã ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã® `~/.claude/settings.json` ã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã« `hooks` ã§ãƒ©ãƒƒãƒ—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

**2. PreCompact ã®åˆ¶é™äº‹é …**
PreCompact ãƒ•ãƒƒã‚¯ã¯ã€ŒExit Code 2 Behavior: N/A - shows stderr to user only, no blocking capabilityã€ã¨ãªã£ã¦ãŠã‚Šã€åœ§ç¸®ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹æ©Ÿèƒ½ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã‚Œã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚çŠ¶æ…‹ä¿å­˜ãŒç›®çš„ãªã®ã§ã€ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

**3. reload-skill.sh ã®å‹•ä½œã«ã¤ã„ã¦**

ææ¡ˆã§ã¯ `reload-skill.sh` ãŒçŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ `cat` ã§å‡ºåŠ›ã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯æ­£ã—ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚SessionStartã®stdoutå‡ºåŠ›ã¯è‡ªå‹•çš„ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹ãŸã‚ã€å†å®Ÿè¡ŒæŒ‡ç¤ºãŒClaudeã«ä¼ã‚ã‚Šã¾ã™ã€‚

---

### ðŸ”§ æŽ¨å¥¨ã•ã‚Œã‚‹æ”¹å–„ç‚¹

**1. çµ¶å¯¾ãƒ‘ã‚¹ã®ä½¿ç”¨**

```bash
# ä¿®æ­£å‰
"command": "~/.claude/hooks/save-skill-state.sh"

# ä¿®æ­£å¾Œï¼ˆæŽ¨å¥¨ï¼‰
"command": "/Users/jushiku/.claude/hooks/save-skill-state.sh"
```

Claude Codeã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€hook scriptsã«ã¯çµ¶å¯¾ãƒ‘ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒæŽ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ç›¸å¯¾ãƒ‘ã‚¹ã‚„`~`ã®å±•é–‹ã«å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

**2. çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’å‹•çš„ã«**

ç¾åœ¨ã® `save-skill-state.sh` ã¯é™çš„ãªã‚¹ã‚­ãƒ«åã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™ãŒã€å®Ÿè¡Œä¸­ã®ã‚¹ã‚­ãƒ«ã‚’å‹•çš„ã«æ¤œå‡ºã™ã‚‹ä»•çµ„ã¿ãŒã‚ã‚‹ã¨ã‚ˆã‚Šæ±Žç”¨çš„ã§ã™ï¼š

```bash
#!/bin/bash
STATE_FILE="$HOME/.claude/skill-state.json"

# transcript_path ã‹ã‚‰ç¾åœ¨ã®çŠ¶æ…‹ã‚’èª­ã¿å–ã‚‹ã“ã¨ã‚‚å¯èƒ½
# ï¼ˆstdinã‹ã‚‰JSONãŒæ¸¡ã•ã‚Œã‚‹ï¼‰
read -r INPUT
TRANSCRIPT_PATH=$(echo "$INPUT" | jq -r '.transcript_path')

cat > "$STATE_FILE" << 'EOF'
{
  "skill": "ebay-sold-count",
  "message": "ã‚¹ã‚­ãƒ« ebay-sold-count ã‚’å†å®Ÿè¡Œã—ã€Xåˆ—ãŒç©ºã®è¡Œã‹ã‚‰å‡¦ç†ã‚’å†é–‹ã—ã¦ãã ã•ã„ã€‚UIãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã§æœŸé–“ã‚’é¸æŠžã—ã€Researchãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ¤œç´¢ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã€‚URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã®æœŸé–“å¤‰æ›´ã¯ç¦æ­¢ã€‚"
}
EOF
```

**3. SKILL.md ã®é‡è¦ãƒ«ãƒ¼ãƒ«ã‚’ã‚ˆã‚Šç›®ç«‹ã¤ä½ç½®ã«**

SKILL.mdã®å†’é ­ã«é‡è¦ãƒ«ãƒ¼ãƒ«ã‚’é…ç½®ã™ã‚‹ã®ã¯æ­£ã—ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ãŒã€åœ§ç¸®å¾Œã®ã‚µãƒžãƒªãƒ¼ã«ã‚‚æ®‹ã‚‹ã‚ˆã†ã«ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å·¥å¤«ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ï¼š

```markdown
## ðŸš¨ CRITICAL RULES (MUST PRESERVE AFTER COMPACTION)

**FORBIDDEN**: dayRange URL parameter
**REQUIRED**: UI pulldown â†’ Research button click
```

---

### ðŸ“‹ æœ€çµ‚çš„ãªå®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

| é …ç›® | çŠ¶æ…‹ | å‚™è€ƒ |
|------|------|------|
| PreCompact with matcher "auto" | âœ… | æ­£ã—ãå‹•ä½œ |
| SessionStart with matcher "compact" | âœ… | æ­£ã—ãå‹•ä½œ |
| stdoutãŒã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«æ³¨å…¥ | âœ… | SessionStartã§æœ‰åŠ¹ |
| çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«æ–¹å¼ | âœ… | å•é¡Œãªã— |
| çµ¶å¯¾ãƒ‘ã‚¹ä½¿ç”¨ | âš ï¸ | ä¿®æ­£æŽ¨å¥¨ |
| SKILL.md/CLAUDE.mdä¿æŒ | âœ… | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãŸã‚åœ§ç¸®ã•ã‚Œãªã„ |

---

### ðŸŽ¯ çµè«–

ã“ã®è¨ˆç”»ã¯**æŠ€è¡“çš„ã«å®Ÿç¾å¯èƒ½**ã§ã™ã€‚Hooksã®ä»•æ§˜ã¯æ­£ã—ãç†è§£ã•ã‚Œã¦ãŠã‚Šã€SessionStartã® `matcher: "compact"` ã§compactå¾Œã®ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ãã¾ã™ã€‚

ä¸»ãªæ‡¸å¿µç‚¹ï¼š
1. **ClaudeãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¾“ã†ã‹ã©ã†ã‹**: stdoutã¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã¾ã™ãŒã€ClaudeãŒãã®æŒ‡ç¤ºã‚’å¿…ãšå®Ÿè¡Œã™ã‚‹ä¿è¨¼ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚SKILL.mdã®é‡è¦ãƒ«ãƒ¼ãƒ«ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§åŠ¹æžœã‚’é«˜ã‚ã‚‰ã‚Œã¾ã™ã€‚

2. **å‹•çš„ãªã‚¹ã‚­ãƒ«æ¤œå‡º**: ç¾åœ¨ã®å®Ÿè£…ã¯ã‚¹ã‚­ãƒ«åãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€è¤‡æ•°ã‚¹ã‚­ãƒ«ã‚’ä½¿ã†å ´åˆã¯æ‹¡å¼µãŒå¿…è¦ã§ã™ã€‚

ãƒ†ã‚¹ãƒˆæ‰‹é †ã¨ã—ã¦ã€ã¾ãš `/compact` ã§æ‰‹å‹•åœ§ç¸®ã—ã¦å‹•ä½œç¢ºèªã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚